{
  "id": "loan-application-001",
  "name": "Ð—Ð°ÑÐ²ÐºÐ° Ð½Ð° ÐºÑ€ÐµÐ´Ð¸Ñ‚",
  "description": "Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¿Ð¾Ð´Ð°Ñ‡Ð¸ Ð·Ð°ÑÐ²ÐºÐ¸ Ð½Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¹ ÐºÑ€ÐµÐ´Ð¸Ñ‚",
  "category": "loans",
  "tags": ["ÐºÑ€ÐµÐ´Ð¸Ñ‚", "Ð·Ð°ÑÐ²ÐºÐ°", "Ñ„Ð¸Ð½Ð°Ð½ÑÑ‹"],
  "start_node": "loan_greeting",
  "nodes": [
    {
      "id": "loan_greeting",
      "type": "announce",
      "parameters": {
        "message": "Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² ÑÐµÑ€Ð²Ð¸Ñ ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð²Ð°Ð½Ð¸Ñ! ÐŸÐ¾Ð¼Ð¾Ð¶ÐµÐ¼ Ð¾Ñ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ ÐºÑ€ÐµÐ´Ð¸Ñ‚ Ð±Ñ‹ÑÑ‚Ñ€Ð¾ Ð¸ ÑƒÐ´Ð¾Ð±Ð½Ð¾."
      },
      "next_nodes": ["ask_loan_amount"]
    },
    {
      "id": "ask_loan_amount",
      "type": "ask",
      "parameters": {
        "question": "ÐÐ° ÐºÐ°ÐºÑƒÑŽ ÑÑƒÐ¼Ð¼Ñƒ Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÑ€ÐµÐ´Ð¸Ñ‚? (Ð¾Ñ‚ 5,000 Ð´Ð¾ 500,000 Ð³Ñ€Ð½)",
        "inputType": "number",
        "validation": "\\d+"
      },
      "next_nodes": ["parse_amount"]
    },
    {
      "id": "parse_amount",
      "type": "parse",
      "parameters": {
        "script": "context.loanAmount = parseInt(input); context.validAmount = context.loanAmount >= 5000 && context.loanAmount <= 500000"
      },
      "next_nodes": ["check_amount"],
      "conditions": {
        "error": "ask_loan_amount"
      }
    },
    {
      "id": "check_amount",
      "type": "condition",
      "parameters": {
        "condition": "context.validAmount == true"
      },
      "conditions": {
        "true": "ask_loan_term",
        "false": "amount_error"
      }
    },
    {
      "id": "amount_error",
      "type": "announce",
      "parameters": {
        "message": "Ð¡ÑƒÐ¼Ð¼Ð° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚ 5,000 Ð´Ð¾ 500,000 Ð³Ñ€Ð½. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ðµ Ñ€Ð°Ð·."
      },
      "next_nodes": ["ask_loan_amount"]
    },
    {
      "id": "ask_loan_term",
      "type": "ask",
      "parameters": {
        "question": "ÐÐ° ÐºÐ°ÐºÐ¾Ð¹ ÑÑ€Ð¾Ðº? Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ:\n1. 12 Ð¼ÐµÑÑÑ†ÐµÐ² (ÑÑ‚Ð°Ð²ÐºÐ° 18%)\n2. 24 Ð¼ÐµÑÑÑ†Ð° (ÑÑ‚Ð°Ð²ÐºÐ° 20%)\n3. 36 Ð¼ÐµÑÑÑ†ÐµÐ² (ÑÑ‚Ð°Ð²ÐºÐ° 22%)",
        "inputType": "choice"
      },
      "next_nodes": ["parse_term"]
    },
    {
      "id": "parse_term",
      "type": "parse",
      "parameters": {
        "script": "if(input=='1') {context.term=12; context.rate=18} else if(input=='2') {context.term=24; context.rate=20} else if(input=='3') {context.term=36; context.rate=22} else {context.validTerm=false}"
      },
      "next_nodes": ["calculate_payment"]
    },
    {
      "id": "calculate_payment",
      "type": "announce",
      "parameters": {
        "message": "Ð Ð°ÑÑ‡ÐµÑ‚ ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð°:\nðŸ’° Ð¡ÑƒÐ¼Ð¼Ð°: {context.loanAmount} Ð³Ñ€Ð½\nðŸ“… Ð¡Ñ€Ð¾Ðº: {context.term} Ð¼ÐµÑÑÑ†ÐµÐ²\nðŸ“Š Ð¡Ñ‚Ð°Ð²ÐºÐ°: {context.rate}% Ð³Ð¾Ð´Ð¾Ð²Ñ‹Ñ…\nðŸ’³ Ð•Ð¶ÐµÐ¼ÐµÑÑÑ‡Ð½Ñ‹Ð¹ Ð¿Ð»Ð°Ñ‚ÐµÐ¶: ~{context.monthlyPayment} Ð³Ñ€Ð½"
      },
      "next_nodes": ["ask_confirmation"]
    },
    {
      "id": "ask_confirmation",
      "type": "ask",
      "parameters": {
        "question": "ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´Ð°ÐµÑ‚Ðµ Ð·Ð°ÑÐ²ÐºÑƒ? (Ð´Ð°/Ð½ÐµÑ‚)",
        "inputType": "confirmation"
      },
      "next_nodes": ["parse_confirmation"]
    },
    {
      "id": "parse_confirmation",
      "type": "parse",
      "parameters": {
        "script": "context.confirmed = input.toLowerCase().includes('Ð´Ð°')"
      },
      "next_nodes": ["check_confirmation"]
    },
    {
      "id": "check_confirmation",
      "type": "condition",
      "parameters": {
        "condition": "context.confirmed == true"
      },
      "conditions": {
        "true": "submit_application",
        "false": "cancel_application"
      }
    },
    {
      "id": "submit_application",
      "type": "api-request",
      "parameters": {
        "service": "loan-service",
        "endpoint": "/api/v1/applications",
        "method": "POST",
        "data": {
          "amount": "{context.loanAmount}",
          "term": "{context.term}",
          "rate": "{context.rate}",
          "user_id": "{context.userId}"
        }
      },
      "conditions": {
        "success": "application_success",
        "error": "application_error"
      }
    },
    {
      "id": "application_success",
      "type": "announce",
      "parameters": {
        "message": "âœ… Ð—Ð°ÑÐ²ÐºÐ° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¿Ð¾Ð´Ð°Ð½Ð°!\nðŸ“‹ ÐÐ¾Ð¼ÐµÑ€ Ð·Ð°ÑÐ²ÐºÐ¸: {api_response.application_id}\nðŸ“ž ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ ÑÐ²ÑÐ¶ÐµÑ‚ÑÑ Ñ Ð²Ð°Ð¼Ð¸ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ 2 Ñ‡Ð°ÑÐ¾Ð².\nðŸ“§ Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð½Ð° email."
      },
      "next_nodes": ["send_notification"]
    },
    {
      "id": "send_notification",
      "type": "notification",
      "parameters": {
        "type": "sms",
        "template": "loan_application_submitted",
        "recipient": "{context.userPhone}",
        "data": {
          "application_id": "{api_response.application_id}",
          "amount": "{context.loanAmount}"
        }
      },
      "next_nodes": ["end_success"]
    },
    {
      "id": "application_error",
      "type": "announce",
      "parameters": {
        "message": "âŒ ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ð¾Ð´Ð°Ñ‡Ðµ Ð·Ð°ÑÐ²ÐºÐ¸. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ Ð¸Ð»Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ðº Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ñƒ: 0 800 123 456"
      },
      "next_nodes": ["end_error"]
    },
    {
      "id": "cancel_application",
      "type": "announce",
      "parameters": {
        "message": "Ð—Ð°ÑÐ²ÐºÐ° Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½Ð°. Ð•ÑÐ»Ð¸ Ð¿ÐµÑ€ÐµÐ´ÑƒÐ¼Ð°ÐµÑ‚Ðµ - Ð¾Ð±Ñ€Ð°Ñ‰Ð°Ð¹Ñ‚ÐµÑÑŒ! Ð’ÑÐµÐ³Ð´Ð° Ñ€Ð°Ð´Ñ‹ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ."
      },
      "next_nodes": ["end_cancel"]
    },
    {
      "id": "end_success",
      "type": "announce",
      "parameters": {
        "message": "Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ! Ð–Ð´ÐµÐ¼ Ð²Ð°Ñ ÑÐ½Ð¾Ð²Ð°."
      },
      "next_nodes": []
    },
    {
      "id": "end_error",
      "type": "announce",
      "parameters": {
        "message": "ÐŸÑ€Ð¸Ð½Ð¾ÑÐ¸Ð¼ Ð¸Ð·Ð²Ð¸Ð½ÐµÐ½Ð¸Ñ Ð·Ð° Ð½ÐµÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð°."
      },
      "next_nodes": []
    },
    {
      "id": "end_cancel",
      "type": "announce",
      "parameters": {
        "message": "Ð”Ð¾ ÑÐ²Ð¸Ð´Ð°Ð½Ð¸Ñ!"
      },
      "next_nodes": []
    }
  ],
  "context": {
    "loanAmount": null,
    "term": null,
    "rate": null,
    "monthlyPayment": null,
    "confirmed": false,
    "validAmount": false,
    "userId": null,
    "userPhone": null
  }
}
